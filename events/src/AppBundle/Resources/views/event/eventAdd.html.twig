{% extends 'AppBundle::main_base.html.twig' %}

{% block title %}Seruvent Etkinlik Ekle{% endblock %}
{% block metaDescription %}Topluluk veya kulüp yöneticisi etkinlik ekleyebilir{% endblock %}
{% block metaKeyword %}Seruvent bilkent üniversitesi yönetici etkinlik ekleme {% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    {% stylesheets
        'theme/assets/css/jquery.timepicker.css' filter='cssrewrite' %}
    <link rel="stylesheet" type="text/css" href="{{ asset_url }}" />
    {% endstylesheets %}
{% endblock %}

{% block content %}

    <!-- --------------------------------------------- -->
    <!-- ------------------ CONTENT ------------------ -->
    <!-- --------------------------------------------- -->

    <section class="guppy-section align-center">
        <div class="container">
            <div class="align-left col-sm-12">
                <form id="add_event_form" action="{{ path("event_add_post") }}" method="POST" class="form form-mail-us">
                    <div class="col-sm-12">
                        <h5 class="highlight">Etkinlik Ekle</h5>
                        <br>
                    </div>

                    <div class="col-sm-12 col-md-12">
                        <fieldset>
                            <label for="name">Düzenleyen:</label>
                            <select id="community_id" name="community_id" type="text">
                                {% for communityAdminRole in communityAdminRoles %}
                                    <option value="{{ communityAdminRole.communityUser.community.id }}">{{ communityAdminRole.communityUser.community.name }}</option>
                                {% endfor %}
                            </select>
                        </fieldset>

                        <fieldset>
                            <label for="name">Adı:</label>
                            <input type="text" class="form-control" name="event_title" pattern=".{1,}" oninput='checkValidation(this , "Etkinlik ismi boş bırakılamaz")' oninvalid='checkValidation(this , "Etkinlik ismi boş bırakılamaz")' required/>
                        </fieldset>

                        <fieldset>
                            <label for="seruvent_date">Tarihi:</label><p></p>
                            <input id="seruvent_date" name="seruvent_date" type="text" pattern="(0[1-9]|1[0-9]|2[0-9]|3[01])/(0[1-9]|1[012])/[0-9]{4}"
                                   {% if selectedDate is defined and selectedDate is not null %} value="{{ selectedDate }}" {% endif %}
                                   oninput='checkValidation(this , "Tarih formatı dd/mm/yyyy olmalıdır")'
                                   onchange='checkValidation(this , "Tarih formatı dd/mm/yyyy olmalıdır")'
                                   oninvalid='checkValidation(this , "Tarih formatı dd/mm/yyyy olmalıdır")' required />
                        </fieldset>
                        <fieldset>
                            <label for="seruvent_time">Saati:</label><p></p>
                            <input id="seruvent_time" name="seruvent_time" type="text" maxlength="5" pattern="([0-1][0-9]|2[0-3]):([0-5][0-9])" oninput='checkValidation(this , "Saat formatı ss:dd olmalıdır")' onchange='checkValidation(this , "Saat formatı ss:dd olmalıdır")' oninvalid='checkValidation(this , "Saat formatı ss:dd olmalıdır")' required/>
                        </fieldset>

                        <fieldset style="display: none;">
                            <label for="date">Tarihi:</label><p></p>
                            <input id="event_date" name="event_date" type="text">
                        </fieldset>
                        <fieldset>
                            <label for="name">Açıklaması:</label>
                            <textarea id="event_description" name="event_description"><h6>ETKİNLİK HAKKINDA</h6></textarea>
                        </fieldset>
                        <fieldset>
                            <br/>
                            <label>Görünürlüğü:</label>
                            <select id="event_permission" class="form-control" name="event_permission">
                                <option value="PUBLIC">Herkese Açık</option>
                                <option value="UNIVERSITY">Üniversite Öğrencileri</option>
                                <option value="COMMUNITY">Topluluk Üyeleri</option>
                            </select>
                        </fieldset>
                        <fieldset>
                            <label for="name">Bilet Fiyatı:</label>
                            <input id="event_price" name="event_price" type="number" min="0" oninput='checkValidation(this , "Uygun bilet fiyatını giriniz")' onchange='checkValidation(this , "Uygun bilet fiyatını giriniz")' oninvalid='checkValidation(this , "Uygun bilet fiyatını giriniz")' value="0" required>
                        </fieldset>
                        <fieldset>
                            <label for="name">Maksimum katılımcı sayısı:</label>
                            <input type="number" min="0" class="form-control" name="event_participant_count" oninput='checkValidation(this , "Maksimum katılımcı sayısını giriniz")' onchange='checkValidation(this , "Maksimum katılımcı sayısını giriniz")' oninvalid='checkValidation(this , "Maksimum katılımcı sayısını giriniz")' value="100000">
                        </fieldset>
                        <fieldset>
                            <label>Kapak Fotoğrafı</label>
                            <textarea type="text" style="display: none;" class="form-control" id="event_image_base64" name="event_image_base64"></textarea>

                            <div class="image-editor">
                                <input type="file" class="cropit-image-input">
                                <div class="cropit-preview"></div>
                                <div class="image-size-label">
                                    Kapak fotoğrafını ayarla
                                </div>
                                <input type="range" class="cropit-image-zoom-input">
                            </div>
                        </fieldset>
                        <fieldset>
                            <label for="name">Konumu:</label>
                            <input id="search_event_location" name="search_event_location" type="text" size="150">
                            <input id="event_location_lat" name="event_location_lat" value="39.873441" style="display: none;"/>
                            <input id="event_location_lng" name="event_location_lng" value="32.747669" style="display: none;"/>
                            <div id="event_location" style="height: 400px;"></div>
                        </fieldset>

                        <fieldset>
                            <input id="submit_event" type="submit" class="btn btn-solid" value="Submit">
                        </fieldset>

                    </div>
                </form>
            </div>
        </div>
    </section>

{% endblock %}


{% block javascriptcontent %}
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    {% javascripts
            'theme/assets/cropit/jquery.cropit.js'
            'theme/assets/js/jquery.timepicker.js'%}
        <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}
    <style>
        .cropit-preview {
            background-color: #f8f8f8;
            background-size: cover;
            border: 1px solid #ccc;
            border-radius: 3px;
            margin-top: 7px;
            width: 600px;
            height: 400px;
        }

        .cropit-preview-image-container {
            cursor: move;
        }

        .image-size-label {
            margin-top: 10px;
        }

        input, .export {
            display: block;
        }

        button {
            margin-top: 10px;
        }
    </style>

    <script>

/***********************************************************************************************************************
 *                                          LOCAL VARIABLE
 **********************************************************************************************************************/
        var autocomplete;
        var map;


/***********************************************************************************************************************
 *                                          UTIL FUNCTIONS
 **********************************************************************************************************************/
        function fillInAddress(e) {
            // Get the place details from the autocomplete object.
            var place = autocomplete.getPlace();

            $("#event_location_lat").val(place.geometry.location.lat());
            $("#event_location_lng").val(place.geometry.location.lng());
            marker.setPosition(place.geometry.location);
            map.setCenter(place.geometry.location);
            map.setZoom(16);
            $('#search_event_location').val(place.name);
        }

        function checkValidation(input , message) {
            if(input.value==""){
                input.setCustomValidity(message);
            }else{
                input.setCustomValidity("");
            }
        }



        $('#add_event_form').submit(function() {
            var imageData = $('.image-editor').cropit('export');
            $('#event_image_base64').val(imageData);
            return true; // return false to cancel form action
        });

        function initMap() {

            $('.image-editor').cropit({
                imageState: {
                    src: ''
                },
            });

            var input = document.getElementById('search_event_location');
            autocomplete = new google.maps.places.Autocomplete(input);
            autocomplete.addListener('place_changed', fillInAddress);

            var event_gps_location = {lat: parseFloat($('#event_location_lat').val()), lng: parseFloat($('#event_location_lng').val()) };
            map = new google.maps.Map(document.getElementById('event_location'), {
                zoom: 11,
                scrollwheel:  false,
                draggable: true,
                center: event_gps_location,
            });

            marker = new google.maps.Marker({
                position: event_gps_location,
                map: map
            });
            google.maps.event.addListener(map, 'click', function( event ){
                $("#event_location_lat").val(event.latLng.lat());
                $("#event_location_lng").val(event.latLng.lng());
                marker.setPosition(event.latLng);
            });

            // harita autocomplete enter basma durumu
            google.maps.event.addDomListener(input, 'keydown', function(e) {
                if (e.keyCode == 13) {
                    e.preventDefault();
                }
            });
        }

        function fileToBase64Converter() {
            if (this.files && this.files[0]) {
                var FR= new FileReader();
                FR.onload = function(e) {
                    $('#img_viewer').attr('src', e.target.result);
                    $('#event_image_base64').val(e.target.result);
                };
                FR.readAsDataURL( this.files[0] );
            }
        }



/***********************************************************************************************************************
 *                                          AJAX OPERATIONS
 **********************************************************************************************************************/


/***********************************************************************************************************************
 *                                          EVENTS
 **********************************************************************************************************************/


/***********************************************************************************************************************
 *                                          DOCUMENT ON READY
 **********************************************************************************************************************/

        $(function() {

            // BEFORE SUBMIT
            $(document).on('click','#submit_event',function (event) {
                $('#event_date').val($('#seruvent_date').val() + " " +  $('#seruvent_time').val());
            });

        });

        $( "#seruvent_date" ).datepicker( {
            dateFormat: "dd/mm/yy",
            firstDay: 1,
            dayNames: [ "Pazar" ,"Pazartesi", "Salı", "Çarşamba", "Perşembe", "Cuma", "Cumartesi" ],
            dayNamesMin: [ "Paz", "Pzt", "Sal", "Çar", "Per", "Cum", "Cmt" ],
            monthNames: [ "Ocak", "Şubat", "Mart", "Nisan", "Mayıs", "Haziran", "Temmuz", "Ağustos", "Eylül", "Ekim", "Kasım", "Aralık" ],
            monthNamesShort: [ "Oca", "Şub", "Mar", "Nis", "May", "Haz", "Tem", "Ağu", "Eyl", "Eki", "Kas", "Ara" ],
            minDate: new Date()
        });
//        $("#seruvent_date").datepicker("setDate", new Date(2000,10,23));
        $('#seruvent_time').timepicker({
            'timeFormat': 'H:i',
            'forceRoundTime': true
        });


        if ( CKEDITOR.env.ie && CKEDITOR.env.version < 9 )
            CKEDITOR.tools.enableHtml5Elements( document );

        CKEDITOR.config.height = 150;
        CKEDITOR.config.width = 'auto';

        CKEDITOR.editorConfig = function( config ) {
            config.toolbarGroups = [
                { name: 'clipboard', groups: [ 'undo', 'clipboard' ] },
                { name: 'editing', groups: [ 'find', 'selection', 'spellchecker', 'editing' ] },
                { name: 'links', groups: [ 'links' ] },
                { name: 'insert', groups: [ 'insert' ] },
                { name: 'forms', groups: [ 'forms' ] },
                { name: 'tools', groups: [ 'tools' ] },
                { name: 'document', groups: [ 'mode', 'document', 'doctools' ] },
                { name: 'others', groups: [ 'others' ] },
                '/',
                { name: 'basicstyles', groups: [ 'basicstyles', 'cleanup' ] },
                { name: 'paragraph', groups: [ 'list', 'indent', 'blocks', 'align', 'bidi', 'paragraph' ] },
                { name: 'styles', groups: [ 'styles' ] },
                { name: 'colors', groups: [ 'colors' ] },
                { name: 'about', groups: [ 'about' ] }
            ];

            config.removeButtons = 'Underline,Subscript,Superscript,Redo,Undo,Format,Styles';
        };

        CKEDITOR.replace( 'event_description' );

    </script>

    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDLqDBN5nlLAbTBnSrkI0gwft2v6SWFjh8&callback=initMap&libraries=places">
    </script>


{% endblock %}
